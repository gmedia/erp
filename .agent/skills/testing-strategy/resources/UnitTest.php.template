<?php

namespace Tests\Unit\Actions\{{Features}};

use App\Actions\{{Features}}\Index{{Features}}Action;
use App\Domain\{{Features}}\{{Feature}}FilterService;
use App\Http\Requests\{{Features}}\Index{{Feature}}Request;
use App\Models\{{Feature}};
use Illuminate\Contracts\Pagination\LengthAwarePaginator;
use Illuminate\Foundation\Testing\RefreshDatabase;
use Tests\TestCase;

/**
 * Unit tests for Index{{Features}}Action.
 *
 * TESTING GUIDELINES:
 * - Focus on business logic
 * - Mock dependencies if needed
 * - Test edge cases
 */
class Index{{Features}}ActionTest extends TestCase
{
    use RefreshDatabase;

    private Index{{Features}}Action $action;

    protected function setUp(): void
    {
        parent::setUp();
        $this->action = new Index{{Features}}Action(new {{Feature}}FilterService());
    }

    public function test_execute_returns_paginator(): void
    {
        {{Feature}}::factory()->count(5)->create();
        
        $request = Index{{Feature}}Request::create('/api/{{features}}', 'GET');

        $result = $this->action->execute($request);

        $this->assertInstanceOf(LengthAwarePaginator::class, $result);
        $this->assertCount(5, $result->items());
    }

    public function test_execute_filters_by_search(): void
    {
        {{Feature}}::factory()->create(['name' => 'Alpha']);
        {{Feature}}::factory()->create(['name' => 'Beta']);
        
        $request = Index{{Feature}}Request::create('/api/{{features}}', 'GET', ['search' => 'Alpha']);

        $result = $this->action->execute($request);

        $this->assertCount(1, $result->items());
        $this->assertEquals('Alpha', $result->items()[0]->name);
    }

    public function test_execute_respects_pagination(): void
    {
        {{Feature}}::factory()->count(20)->create();
        
        $request = Index{{Feature}}Request::create('/api/{{features}}', 'GET', ['per_page' => 5]);

        $result = $this->action->execute($request);

        $this->assertCount(5, $result->items());
        $this->assertEquals(20, $result->total());
    }

    public function test_execute_sorts_by_column(): void
    {
        {{Feature}}::factory()->create(['name' => 'Zebra']);
        {{Feature}}::factory()->create(['name' => 'Alpha']);
        
        $request = Index{{Feature}}Request::create('/api/{{features}}', 'GET', [
            'sort_by' => 'name',
            'sort_direction' => 'asc',
        ]);

        $result = $this->action->execute($request);

        $this->assertEquals('Alpha', $result->items()[0]->name);
    }
}
