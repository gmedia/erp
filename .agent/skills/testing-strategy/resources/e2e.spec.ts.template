import { test, expect } from '@playwright/test';

/**
 * E2E Tests for {{Feature}} Module
 * 
 * TESTING GUIDELINES:
 * - Use data-testid for selectors (stable across refactors)
 * - Test user journeys, not implementation details
 * - Clean up test data when needed
 */

test.describe('{{Feature}} CRUD Operations', () => {
    
    test.beforeEach(async ({ page }) => {
        // Login and navigate to {{features}} page
        await page.goto('/{{features}}');
        // Add authentication if needed
        // await page.fill('[data-testid="email-input"]', 'admin@example.com');
    });

    // ==================== LIST ====================

    test('displays {{features}} list', async ({ page }) => {
        await expect(page.locator('[data-testid="{{features}}-table"]')).toBeVisible();
    });

    // ==================== CREATE ====================

    test('can add new {{feature}}', async ({ page }) => {
        // Click add button
        await page.click('[data-testid="add-{{feature}}-btn"]');
        
        // Fill form
        await page.fill('[data-testid="{{feature}}-name-input"]', 'Test {{Feature}}');
        
        // Submit
        await page.click('[data-testid="{{feature}}-submit-btn"]');
        
        // Verify created
        await expect(page.locator('text=Test {{Feature}}')).toBeVisible();
    });

    test('shows validation error for empty name', async ({ page }) => {
        await page.click('[data-testid="add-{{feature}}-btn"]');
        await page.click('[data-testid="{{feature}}-submit-btn"]');
        
        await expect(page.locator('text=name is required')).toBeVisible();
    });

    // ==================== EDIT ====================

    test('can edit {{feature}}', async ({ page }) => {
        // Click first row's edit button
        await page.click('[data-testid="{{feature}}-edit-1"]');
        
        // Modify name
        await page.fill('[data-testid="{{feature}}-name-input"]', 'Updated Name');
        
        // Save
        await page.click('[data-testid="{{feature}}-submit-btn"]');
        
        // Verify updated
        await expect(page.locator('text=Updated Name')).toBeVisible();
    });

    // ==================== DELETE ====================

    test('can delete {{feature}}', async ({ page }) => {
        // Get name before delete
        const name = await page.locator('[data-testid="{{feature}}-name-1"]').textContent();
        
        // Click delete
        await page.click('[data-testid="{{feature}}-delete-1"]');
        
        // Confirm delete
        await page.click('[data-testid="confirm-delete-btn"]');
        
        // Verify deleted
        await expect(page.locator(`text=${name}`)).not.toBeVisible();
    });

    // ==================== FILTER ====================

    test('can filter {{features}} by search', async ({ page }) => {
        await page.fill('[data-testid="search-input"]', 'Specific Name');
        await page.press('[data-testid="search-input"]', 'Enter');
        
        // Wait for results
        await page.waitForTimeout(500);
        
        // Verify filter applied
        const rows = await page.locator('[data-testid="{{feature}}-row"]').count();
        expect(rows).toBeLessThanOrEqual(1);
    });

    // ==================== EXPORT ====================

    test('can export {{features}}', async ({ page }) => {
        // Start download
        const downloadPromise = page.waitForEvent('download');
        await page.click('[data-testid="export-btn"]');
        
        const download = await downloadPromise;
        
        // Verify download
        expect(download.suggestedFilename()).toContain('{{features}}');
    });
});
